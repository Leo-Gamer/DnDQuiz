<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>é»‘æ–å¡”ï¼šæ–°ç”Ÿäººæ ¼è©¦ç…‰ 2.5</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link href="https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@700&family=Spectral:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">

    <style>
        :root {
            --parchment-light: #fdf6e3;
            --parchment-dark: #eee8d5;
            --ink-primary: #261b13;
            --accent-brown: #856743;
            --burn-orange: #ff4500;
            --magic-gold: #b58900;
        }

        body {
            font-family: 'Spectral', serif;
            margin: 0; padding: 2rem 1rem;
            background: #0f0f0f;
            color: var(--ink-primary);
            overflow-x: hidden;
        }

        .parchment-container {
            max-width: 700px;
            margin: 0 auto;
            background: var(--parchment-dark);
            background-image: url('https://www.transparenttextures.com/patterns/p6.png');
            padding: 3rem;
            border: 1px solid var(--accent-brown);
            box-shadow: 0 20px 60px rgba(0,0,0,0.7), inset 0 0 100px rgba(133, 103, 67, 0.2);
            position: relative;
            min-height: 500px;
        }

        /* ç‡’è•å‹•ç•« */
        .burning { animation: burnAway 0.8s forwards; }
        @keyframes burnAway {
            0% { transform: scale(1); filter: brightness(1); opacity: 1; }
            40% { filter: brightness(2) sepia(1) saturate(3) drop-shadow(0 0 15px var(--burn-orange)); }
            100% { transform: scale(1.05); filter: brightness(0); opacity: 0; }
        }

        .hidden { display: none !important; }
        h1, h2 { font-family: 'Cinzel Decorative', cursive; text-align: center; }
        h1 { font-size: 1.8rem; border-bottom: 2px solid var(--accent-brown); margin-bottom: 20px; }

        .input-group { text-align: center; margin: 3rem 0; }
        input[type="text"] {
            background: transparent; border: none; border-bottom: 2px solid var(--ink-primary);
            font-size: 1.4rem; text-align: center; width: 85%; outline: none; padding: 10px; color: var(--ink-primary);
        }

        .btn-magic {
            display: block; width: 100%; padding: 1.2rem; background: var(--ink-primary);
            color: var(--parchment-light); font-family: 'Cinzel Decorative', cursive;
            border: none; cursor: pointer; font-size: 1.1rem; margin-top: 20px; transition: 0.3s;
            box-shadow: 0 4px 10px rgba(0,0,0,0.3);
        }
        .btn-magic:hover { background: var(--accent-brown); transform: translateY(-2px); }

        .btn-finalize {
            background: #4a0404; /* æ·±ç´…è‰²ä»£è¡¨æœ€çµ‚æ±ºå®š */
            border: 2px solid var(--magic-gold);
            font-size: 1.4rem;
            margin-top: 40px;
        }

        .option-label {
            display: flex; align-items: center; background: rgba(0,0,0,0.04);
            margin: 12px 0; padding: 15px; cursor: pointer; border-radius: 6px; border: 1px solid transparent;
        }
        .option-label:hover { background: rgba(133, 103, 67, 0.1); border: 1px solid var(--accent-brown); }
        input[type="radio"] { margin-right: 15px; transform: scale(1.3); }

        .result-card { background: white; padding: 2rem; border: 3px double var(--accent-brown); text-align: center; }
        .score-list { font-size: 0.9rem; text-align: left; background: #f4f4f4; padding: 15px; margin-top: 15px; border-radius: 4px; }
    </style>
</head>
<body>

<div class="parchment-container" id="mainBoard">
    
    <div id="stage-entry">
        <h1>é»‘æ–å¡”ï¼šæ–°ç”Ÿè©¦ç…‰</h1>
        <div class="input-group">
            <p>å­¸å¾’ï¼Œåœ¨é–‹å•Ÿè©¦ç…‰å·è»¸å‰ï¼Œè«‹ç°½ä¸‹ä½ çš„çœŸåï¼š</p>
            <input type="text" id="playerName" placeholder="æ›¸å¯«æ­¤è™•..." autocomplete="off">
            <p style="color: #8b0000; font-style: italic; margin-top: 20px; font-weight: bold;">ã€Œè«‹å±é™¤é›œå¿µï¼Œå‚¾è½éˆé­‚æ·±è™•çš„è²éŸ³ã€‚ã€</p>
            <button class="btn-magic" onclick="startQuiz()">é–‹å•Ÿè©¦ç…‰å·è»¸</button>
        </div>
    </div>

    <div id="stage-quiz" class="hidden">
        <p id="question-counter" style="text-align: right; font-weight: bold; color: var(--accent-brown);"></p>
        <h2 id="question-text" style="font-size: 1.25rem; margin: 1.5rem 0;"></h2>
        <div id="options-container"></div>
        <button class="btn-magic" id="nextBtn" onclick="processNext()">æ³¨å…¥é­”åŠ› Â· ä¸‹ä¸€é¡Œ</button>
    </div>

    <div id="stage-finalize" class="hidden" style="text-align: center;">
        <h1>è©¦ç…‰çµ‚äº†</h1>
        <p style="margin: 2rem 0; font-size: 1.1rem;">æ‰€æœ‰çš„å›ç­”å·²åˆ»å…¥éˆé­‚å·è»¸ã€‚<br>æº–å‚™å¥½æ¥å—ä½ çš„å‘½é‹äº†å—ï¼Ÿ</p>
        <button class="btn-magic btn-finalize" onclick="finalizeRitual()">ç²å–é‘‘å®šçµæœ & å‚³é€å·è»¸</button>
    </div>

    <div id="stage-result" class="hidden">
        <h1>é‘‘å®šçµæœ</h1>
        <div id="result-content"></div>
        <p style="text-align: center; margin-top: 20px; color: var(--magic-gold); font-weight: bold;">
            ğŸª„ è¨Šæ¯å·²ç”±ã€Œå‚³é€è¡“ã€é€å¾€é­”å°å¸«ä¿¡ç®±...
        </p>
        <button class="btn-magic" onclick="location.reload()">é‡æ–°é€²è¡Œé‘‘å®š</button>
    </div>

</div>

<script>
    const questions = [
        { q: "åœ¨ä¸€å ´æ··äº‚çš„ä¼æ“Šä¸­ï¼Œä½ ä¸‹æ„è­˜å°‹æ‰¾çš„ä½ç½®æ˜¯ï¼Ÿ", options: [
            { t: "ç«™åœ¨å—å‚·éšŠå‹æ—ï¼Œéš¨æ™‚æº–å‚™æ–½æ•‘", v: "A" },
            { t: "æ»‘å‘é™°å½±æˆ–é«˜è™•ï¼Œå°‹æ‰¾æ•µæ–¹æ­»è§’", v: "B" },
            { t: "è¡å‘æœ€å‰æ–¹ï¼Œè¿«ä½¿æ•µäººå°‡ç›®æ¨™é–å®šä½ ", v: "C" },
            { t: "ä¿æŒå®‰å…¨è·é›¢ï¼Œæº–å‚™å¤§å‹å¹²æ“¾é­”æ³•", v: "D" }
        ]},
        { q: "é¢å°ä¸€é“ç„¡æ³•é–‹å•Ÿçš„é­”æ³•å¯†é–€ï¼Œä½ æœƒï¼Ÿ", options: [
            { t: "è§£æç¬¦æ–‡è¿´è·¯ï¼Œå˜—è©¦ç†æ€§æ‹†è§£é­”æ³•", v: "A" },
            { t: "ç¥ˆæ±‚ç¥æ€§æˆ–è‡ªç„¶çš„å¾µå…†ä¾†æ­ç¤ºè·¯å¾‘", v: "B" },
            { t: "ä½¿ç”¨ç²¾å¯†å·¥å…·æˆ–å¼·é…¸é€²è¡ŒæŠ€è¡“ç ´å£", v: "C" },
            { t: "æ¸¬è©¦å¤§é–€çµæ§‹ï¼Œå˜—è©¦ç”¨è »åŠ›å¼·è¡Œç ´é–‹", v: "D" }
        ]},
        { q: "è²ªå©ªå•†äººæ¡æœ‰æƒ…å ±å»ç´¢è¦å¤©åƒ¹ï¼Œä½ æœƒï¼Ÿ", options: [
            { t: "æ›‰ä»¥å¤§ç¾©ï¼Œå˜—è©¦å–šé†’ä»–çš„æ¦®è­½æ„Ÿ", v: "A" },
            { t: "è¶ä»–ä¸æ³¨æ„æ½›å…¥è¾¦å…¬å®¤ã€Œå€Ÿç”¨ã€æƒ…å ±", v: "B" },
            { t: "å±•éœ²æ­¦åŠ›æˆ–æ°£å ´ï¼Œç›´æ¥é€¼ä»–å°±ç¯„", v: "C" },
            { t: "å†·éœåœ°äº¤æ˜“ï¼Œç”šè‡³ä»¥ä»–çš„æŠŠæŸ„ä½œç‚ºè«‡åˆ¤ç±Œç¢¼", v: "D" }
        ]},
        { q: "åœ¨å¤œå®¿é‡å¤–çš„ç‡Ÿç«æ—ï¼Œä½ é€šå¸¸åœ¨åšä»€éº¼ï¼Ÿ", options: [
            { t: "ç£¨ç·´æ­¦å™¨æˆ–ç ”ç©¶åˆ»åœ¨è£å‚™ä¸Šçš„ç¬¦æ–‡", v: "A" },
            { t: "è§€å¯Ÿæ˜Ÿè±¡è®ŠåŒ–æˆ–èˆ‡é™„è¿‘çš„ç”Ÿç‰©ä½èª", v: "B" },
            { t: "æ”¹é€ ä½ çš„èƒŒåŒ…é›¶ä»¶ï¼Œè©¦åœ–åšäº›å°ç™¼æ˜", v: "C" },
            { t: "èˆ‡éšŠå‹è«‡å¤©èªªç¬‘ï¼Œæˆ–åœ¨å®‰éœè™•ç¦±å‘Š", v: "D" }
        ]},
        { q: "ä½ ç”³è«‹é€²å…¥é»‘æ–å¡”æœ€æ ¸å¿ƒçš„å‹•æ©Ÿæ˜¯ï¼Ÿ", options: [
            { t: "ç‚ºäº†ä¿è­·é‚£äº›å¼±å°ä¸”ç„¡åŠ©çš„äºº", v: "A" },
            { t: "ç‚ºäº†æ¢ç´¢è¢«ç¦æ­¢æˆ–æœªçŸ¥çš„ç§‘å­¸èˆ‡çŸ¥è­˜", v: "B" },
            { t: "ç‚ºäº†å­¸æœƒæ§åˆ¶æˆ‘ä¸ç©©å®šçš„åŸå§‹é­”åŠ›", v: "C" },
            { t: "ç‚ºäº†åœ¨æ­·å²ä¸­ç•™ä¸‹å±¬æ–¼æˆ‘çš„è‹±é›„äº‹è¹Ÿ", v: "D" }
        ]},
        { q: "ç•¶è¨ˆç•«å¾¹åº•å¤±æ•—æ™‚ï¼Œä½ çš„ç¬¬ä¸€ç›´è¦ºåæ‡‰æ˜¯ï¼Ÿ", options: [
            { t: "æ€’å¼ä¸€è²ï¼Œä¸¦ç«‹åˆ»å°‹æ‰¾ä¸‹ä¸€å€‹æ‰“æ“Šç›®æ¨™", v: "A" },
            { t: "è‡ªè²¬ä½†ä¿æŒæº«æŸ”ï¼Œå„ªå…ˆæ²»ç™‚å—å‚·çš„åŒä¼´", v: "B" },
            { t: "éœ²å‡ºä¸€æŠ¹è‹¦ç¬‘ï¼Œå¿«é€Ÿéš±å…¥å¾Œæ–¹å•Ÿå‹•å‚™æ¡ˆ", v: "C" },
            { t: "è¿…é€Ÿåœ¨è…¦ä¸­åˆ†æå¤±æ•—æ•¸æ“šï¼Œé¿å…ä¸‹æ¬¡å‡ºéŒ¯", v: "D" }
        ]},
        { q: "ä½ çš„è¡Œå›Šä¸­çµ•å°ä¸èƒ½ç¼ºå°‘çš„ç‰©å“æ˜¯ï¼Ÿ", options: [
            { t: "ä»£è¡¨å®¶è¨“çš„è­·èº«ç¬¦æˆ–ä¸€é¢å …å›ºçš„ç›¾ç‰Œ", v: "A" },
            { t: "ä¸€å¥—ç²¾å¯†å·¥å…·çµ„æˆ–å¥‡æ€ªçš„è—¥åŠ‘ç“¶", v: "B" },
            { t: "ä¸€ç–Šæ˜Ÿåœ–ã€è Ÿç‡­æˆ–ç¥è–çš„é¦™æ²¹", v: "C" },
            { t: "å¹¾æŠŠæ–¹ä¾¿éš±è—çš„åŒ•é¦–æˆ–éª°å­éŠæˆ²", v: "D" }
        ]},
        { q: "éšŠä¼ä¸­å‡ºç¾æ„è¦‹åš´é‡åˆ†æ­§æ™‚ï¼Œä½ æœƒå¦‚ä½•è™•ç†ï¼Ÿ", options: [
            { t: "ä½œç‚ºä»²è£è€…ï¼Œå°‹æ±‚æœ€ç¬¦åˆé“å¾·çš„æŠ˜è¡·é»", v: "A" },
            { t: "ä¸å±‘çˆ­è«–ï¼Œç›´æ¥å»åšä½ èªç‚ºæœ€æœ‰æ•ˆç‡çš„äº‹", v: "B" },
            { t: "ç”¨å·¨å¤§çš„è²é‡æˆ–æ°£å ´å£“åˆ¶æ··äº‚ï¼Œå¼·è¡Œæ¨é€²", v: "C" },
            { t: "å†·çœ¼æ—è§€ï¼Œä¸¦éš¨æ™‚æº–å‚™æ‡‰å°çˆ­è«–å¼•ç™¼çš„æ„å¤–", v: "D" }
        ]},
        { q: "ä½ å¸Œæœ›åœ¨å†’éšªçµæŸå¾Œï¼Œä¸–äººå¦‚ä½•è¨˜å¾—ä½ ï¼Ÿ", options: [
            { t: "ä¸€ä½ç„¡ç§çš„å®ˆè­·è€…èˆ‡å…‰èŠ’çš„å‚³éè€…", v: "A" },
            { t: "ä¸€ä½è§£é–‹ä¸–ç•Œçµ‚æ¥µå¥§ç§˜çš„å¤©æ‰å¤§å¸«", v: "B" },
            { t: "ä¸€ä½ç„¡äººèƒ½æ•µã€å……æ»¿é‡æ€§çš„å‚³å¥‡æˆ°å£«", v: "C" },
            { t: "ä¸€ä½èƒ½åœ¨æœ€çµ•æœ›æ™‚åˆ»åè½‰å±€å‹¢çš„å½±å­", v: "D" }
        ]}
    ];

    const weightMatrix = {
        0: { A: { cleric: 5, paladin: 3 }, B: { trickster: 5 }, C: { barbarian: 5, runeknight: 3 }, D: { starsdruid: 4, artificer: 2 } },
        1: { A: { runeknight: 4, artificer: 3 }, B: { cleric: 4, starsdruid: 5 }, C: { artificer: 5, trickster: 2 }, D: { barbarian: 4, paladin: 3 } },
        2: { A: { cleric: 3, paladin: 5 }, B: { trickster: 5 }, C: { barbarian: 5, runeknight: 2 }, D: { artificer: 4, starsdruid: 4 } },
        3: { A: { runeknight: 5, paladin: 2 }, B: { starsdruid: 5, cleric: 2 }, C: { artificer: 5 }, D: { cleric: 4, trickster: 3 } },
        4: { A: { paladin: 5, cleric: 4 }, B: { artificer: 5, starsdruid: 3 }, C: { barbarian: 5, runeknight: 2 }, D: { trickster: 4, runeknight: 3 } },
        5: { A: { barbarian: 5, runeknight: 2 }, B: { cleric: 5, paladin: 3 }, C: { trickster: 5, starsdruid: 2 }, D: { artificer: 5, starsdruid: 3 } },
        6: { A: { paladin: 4, runeknight: 4 }, B: { artificer: 5 }, C: { starsdruid: 5, cleric: 4 }, D: { trickster: 5 } },
        7: { A: { cleric: 4, paladin: 4 }, B: { artificer: 5, starsdruid: 3 }, C: { barbarian: 5, runeknight: 2 }, D: { trickster: 4 } },
        8: { A: { cleric: 5, paladin: 5 }, B: { artificer: 5, starsdruid: 5 }, C: { barbarian: 5, runeknight: 4 }, D: { trickster: 5 } }
    };

    const classNames = { cleric: "ç”Ÿå‘½é ˜åŸŸç‰§å¸«", trickster: "å¥§è¡“è©­å½±ç›œè³Š", barbarian: "ç‹‚é‡é­”æ³•é‡è »äºº", paladin: "è–é¨å£«", runeknight: "ç¬¦æ–‡é¨å£«", artificer: "å·¥åŒ  (Artificer)", starsdruid: "æ˜Ÿç’°å¾·é­¯ä¼Š" };

    let currentStep = 0;
    let scores = { cleric: 0, trickster: 0, barbarian: 0, paladin: 0, runeknight: 0, artificer: 0, starsdruid: 0 };
    let pName = "";

    function startQuiz() {
        pName = document.getElementById('playerName').value;
        if (!pName) { alert("å­¸å¾’ï¼Œè«‹ç°½ä¸‹ä½ çš„çœŸåã€‚"); return; }
        document.getElementById('stage-entry').classList.add('hidden');
        document.getElementById('stage-quiz').classList.remove('hidden');
        renderQuestion();
    }

    function renderQuestion() {
        const qData = questions[currentStep];
        document.getElementById('question-counter').innerText = `å·è»¸é€²åº¦ï¼š${currentStep + 1} / 9`;
        document.getElementById('question-text').innerText = qData.q;
        const optContainer = document.getElementById('options-container');
        optContainer.innerHTML = "";
        qData.options.forEach(opt => {
            const label = document.createElement('label');
            label.className = 'option-label';
            label.innerHTML = `<input type="radio" name="q" value="${opt.v}"> <span>${opt.t}</span>`;
            optContainer.appendChild(label);
        });
    }

    function processNext() {
        const selected = document.querySelector('input[name="q"]:checked');
        if (!selected) { alert("è«‹å‚¾è½å…§å¿ƒä¸¦åšå‡ºé¸æ“‡ã€‚"); return; }
        
        const weights = weightMatrix[currentStep][selected.value];
        for (let cls in weights) scores[cls] += weights[cls];

        const board = document.getElementById('mainBoard');
        board.classList.add('burning');

        setTimeout(() => {
            currentStep++;
            board.classList.remove('burning');
            if (currentStep < questions.length) {
                renderQuestion();
                window.scrollTo(0, 0);
            } else {
                document.getElementById('stage-quiz').classList.add('hidden');
                document.getElementById('stage-finalize').classList.remove('hidden');
            }
        }, 800);
    }

async function finalizeRitual() {
  const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
  const topClass = classNames[sorted[0][0]];

  document.getElementById('stage-finalize').classList.add('hidden');
  document.getElementById('stage-result').classList.remove('hidden');

  let report = `å­¸å¾’: ${pName}\né‘‘å®šçµæœ: ${topClass}\n\nåˆ†æ•¸ç´°ç¯€:\n`;
  sorted.forEach(([k,v]) => { report += `- ${classNames[k]}: ${v}\n`; });

  document.getElementById('result-content').innerHTML = `<h2>ã€ ${topClass} ã€‘</h2><pre>${report}</pre>`;

  const copyArea = document.getElementById('copyArea');
  if (copyArea) copyArea.value = report;

  const backupBox = document.getElementById('backup-box');
  if (backupBox) backupBox.style.display = "none";

  const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbzgP_MdEa15mftQDmhKrMIoM9LAY4lhcPr5ySdea4hNI7gsnvMsP5yI6VWW6Bbfr6ZiZw/exec";

  try {
    const res = await fetch(WEBAPP_URL, {
      method: "POST",
      headers: { "Content-Type": "text/plain;charset=utf-8" },
      body: JSON.stringify({
        subject: "[è©¦ç…‰å ±å‘Š] " + pName,
        body: report
      })
    });

    // ç›¡åŠ›è®€å›æ‡‰ï¼ˆè®€ä¸åˆ°ä¹Ÿä¸ç•¶ä½œå¤±æ•—ï¼‰
    try {
      const text = await res.text();
      console.log("Email response:", text);
    } catch (_) {}

    console.log("Email sent (silent).");
  } catch (err) {
    console.error("Silent email failed:", err);
    if (backupBox) backupBox.style.display = "block"; // åªæœ‰å¤±æ•—æ‰é¡¯ç¤ºå‚™æ´
  }
}

</script>

</body>
</html>
